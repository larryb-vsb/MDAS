Feature Document: Universal Timestamping for TDDF Record Ingestion

Author: Larry B.Collaborator: Replit Agent (Alex)Date: 2023-01-24

Objective

Ensure every line record from TSYS TDDF files receives a universal, chronologically ordered timestamp for database ingestion, display, and sorting. This enables traceability and consistent linkage of mixed record types (e.g., BH, DT, P1, G2) even when embedded timestamps are missing or inconsistent.

Problem Statement

TSYS TDDF files contain various record types (BH, DT, P1, G2, etc.), but only some (notably DT) contain reliable transaction date information. Other records must still be timestamped and sorted to:

Maintain strict file order

Link child records to parent transactions

Enable filtering and auditing by datetime

Proposed Solution

Introduce two fields during ingestion:

parsed_datetime

A computed timestamp for every record.

Reflects real transaction time where available or estimated by file position.

record_time_source

Documents the origin of the timestamp: "dt_line", "bh_line", "file_timestamp", "file_timestamp + line offset", or "ingest_time".

Master Timestamp Logic

parsed_datetime will be computed using the following hierarchy:

If DT has embedded date: use it → record_time_source = "dt_line"

If BH has date and no DT: use BH → record_time_source = "bh_line"

Else: use filename date + line offset → record_time_source = "file_timestamp + line offset"

Timestamp intervals are spaced by 100ms per line, allowing precise reconstruction even in files with 1M+ records.

Example Record Structure

{
  "line_number": 34567,
  "record_type": "P1",
  "record_key": "052854-0004-6759000000028818",
  "linked_to": "052854-0003-6759000000028818",
  "parsed_datetime": "2023-01-24T00:57:36.700",
  "record_time_source": "file_timestamp + line offset",
  "file_timestamp": "2023-01-24T00:00:00",
  "raw_line": "01835030528540003P1675906759..."
}

Benefits

✅ Chronological sort across mixed record types

✅ Full traceability of time source

✅ Consistent linking of parent-child records

✅ Ready for display, export, auditing, and BI tools

Next Steps for Alex (Replit Agent)

Integrate timestamping logic during TDDF parsing

Ensure every record carries both parsed_datetime and record_time_source

Make interval configurable (e.g., 100ms vs 1s)

Optional: align P1/G2 timestamps with parent DT for grouping

Let me know if you'd like this exported as Markdown or embedded in the ingestion engine.

