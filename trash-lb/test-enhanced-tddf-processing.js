// Direct test of enhanced TDDF processing functionality
import { DatabaseStorage } from './server/storage.js';

console.log('üß™ Testing Enhanced TDDF Raw Import Processing...');

// Sample TDDF data with different record types
const testTddfContent = `01696290624670002BH6759067590000000215480088880000090171128202233222000000000853920    0000090001484509N8008886759C11292022
01696300624670003DT67590675900000002154800888800000010180088873011002332900014845093112820220000085392033222000000000853920377972XXXXX1024                          NY 4 07N003321356909322N840000000853920          01DNDRIP DROP DISTRO LLC     266851    AM84000000853920 N  519971004114
01696310624670004A167590675900000000968800888800000010180088887287282332900010154024112820220000000128433222000000000001784531260XXXXXX3486       ME03KE06MS02      NY 4607AMDJMSYA1U1128  N840000000001284          81DNAIRLINE EXTENSION REC    105024    MD84000000001284 N  546200000001
01696320624670005P167590675900000000968800888800000010180088887287282332900010169865112820220000000050033222000000000001784531260XXXXXX3486       ME03KE06MS02      NY 4607AMDJM9XEI01128  N840000000000500          81DNPURCHASING CARD EXT      104051    MD84000000000500 N  546200000001
01696330624670006DR67590675900000000968800888800000010180088887287282332900010169865112820220000000050033222000000000001784531260XXXXXX3486       ME03KE06MS02      NY 4607AMDJM9XEI01128  N840000000000500          81DNDIRECT MARKETING EXT     104051    MD84000000000500 N  546200000001
01696340624670007DT67590675900000000968800888800000010180088887287282332900010169865112820220000000050033222000000000001784531260XXXXXX3486       ME03KE06MS02      NY 4607AMDJM9XEI01128  N840000000000500          81DNHIGHER FLOUR LLC         104051    MD84000000000500 N  546200000001
01696350624670008CT67590675900000000968800888800000010180088887287282332900010169865112820220000000050033222000000000001784531260XXXXXX3486       ME03KE06MS02      NY 4607AMDJM9XEI01128  N840000000000500          81DNCAR RENTAL EXTENSION     104051    MD84000000000500 N  546200000001`;

async function testEnhancedTddfProcessing() {
  try {
    const storage = new DatabaseStorage();
    
    // Create a test file content (base64 encoded)
    const base64Content = Buffer.from(testTddfContent).toString('base64');
    const testFileId = `test_enhanced_processing_${Date.now()}`;
    
    console.log('üìÇ Test file ID:', testFileId);
    console.log('üìÑ Content lines:', testTddfContent.split('\n').length);
    
    // Process the content with enhanced raw import functionality
    const result = await storage.processTddfFileFromContent(
      base64Content, 
      testFileId, 
      'test_enhanced_processing.TSYSO'
    );
    
    console.log('\n‚úÖ Processing completed successfully!');
    console.log('üìä Results:', result);
    
  } catch (error) {
    console.error('‚ùå Test failed:', error);
  }
}

// Run the test
testEnhancedTddfProcessing();